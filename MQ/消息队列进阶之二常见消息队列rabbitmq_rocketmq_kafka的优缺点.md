# 消息队列进阶之二常见消息队列rabbitmq，rocketmq，kafka的优缺点



## 常见消息队列比较

| 产品     | 优点                                                         | 不足                                                         |
| -------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| RabbitMQ | 轻量级、易部署；支持灵活的路由配置；<br/>兼容性好；管理后台使用方便 | 对消息堆积的支持并不好；<br/>与RocketMQ、Kafka相比，性能相对较差（每秒处理几万-几十万）；<br/>实现语言是Erlang，学习曲线较为陡峭，不利于扩展或是二次开发 |
| Kafka    | 设计初衷：处理海量的日志；<br/>与周边生态系统的兼容性非常好，<br/>尤其在大数据和流计算领域；<br/>Kafka 的性能，尤其是异步收发的性能，<br/>在RabbitMQ/Kafka/RocketMQ中是最好的，<br/>但与 RocketMQ没有量级上的差异，大约每秒钟可处理几十万条消息 | 同步收发消息的响应时延比较高。<br/>Broker 中多处使用“先攒一波再一起处理”的设计，<br/>不太适合在线业务场景。<br/>topic从几十个到几百个的时候，吞吐量会大幅度下降。<br/>所以在同等机器下，kafka尽量保证topic数量不要过多。<br/>如果要支撑大规模topic，需要增加更多的机器资源 |
| RocketMQ | 阿里出品，性能、稳定性和可靠性经受<br/>多次双十一考验；<br/>中文社区活跃，容易扩展或是二次开发；<br/>对在线业务的响应时延做了很多的优化，<br/>大多数情况下可以做到毫秒级的响应，<br/>若注重响应时延，可尝试之；<br/>每秒钟大概能处理几十万条消息，高出<br/>RabbitMQ一个量级 | 国产，国际上没有那么流行，周<br/>边生态系统集成和兼容程序略逊色 |

更进一步的阐述参见下面：引自中华石杉Java工程师面试突击

```text
ActiveMQ
　　单机吞吐量：万级
　　topic数量对吞吐量的影响：
　　时效性：ms级
　　可用性：高，基于主从架构实现高可用性
　　消息可靠性：有较低的概率丢失数据
　　功能支持：MQ领域的功能极其完备
　　总结：
　　　　非常成熟，功能强大，在早些年业内大量的公司以及项目中都有应用  
　　　　偶尔会有较低概率丢失消息  
　　　　现在社区以及国内应用都越来越少，官方社区现在对ActiveMQ 5.x维护越来越少，几个月才发布一个版本   
　　　　主要是基于解耦和异步来用的，较少在大规模吞吐的场景中使用

RabbitMQ
　　单机吞吐量：万级
　　topic数量对吞吐量的影响：
　　时效性：微秒级，延时低是一大特点。
　　可用性：高，基于主从架构实现高可用性
　　消息可靠性：
　　功能支持：基于erlang开发，所以并发能力很强，性能极其好，延时很低
　　总结：　　
　　　　erlang语言开发，性能极其好，延时很低；  
　　　　吞吐量到万级，MQ功能比较完备  
　　　　开源提供的管理界面非常棒，用起来很好用  
　　　　社区相对比较活跃，几乎每个月都发布几个版本分  
　　　　在国内一些互联网公司近几年用rabbitmq也比较多一些   但是问题也是显而易见的，RabbitMQ确实吞吐量会低一些，这是因为他做的实现机制比较重。  
　　　　erlang开发，很难去看懂源码，基本职能依赖于开源社区的快速维护和修复bug。  
　　　　rabbitmq集群动态扩展会很麻烦，不过这个我觉得还好。其实主要是erlang语言本身带来的问题。很难读源码，很难定制和掌控。

RocketMQ
　　单机吞吐量：十万级
　　topic数量对吞吐量的影响：topic可以达到几百，几千个的级别，吞吐量会有较小幅度的下降。可支持大量topic是一大优势。
　　时效性：ms级
　　可用性：非常高，分布式架构
　　消息可靠性：经过参数优化配置，消息可以做到0丢失
　　功能支持：MQ功能较为完善，还是分布式的，扩展性好
　　总结：
　　　　接口简单易用，可以做到大规模吞吐，性能也非常好，分布式扩展也很方便，社区维护还可以，可靠性和可用性都是ok的，还可以支撑大规模的topic数量，支持复杂MQ业务场景  
　　　　而且一个很大的优势在于，源码是java，我们可以自己阅读源码，定制自己公司的MQ，可以掌控  
　　　　社区活跃度相对较为一般，不过也还可以，文档相对来说简单一些，然后接口这块不是按照标准JMS规范走的有些系统要迁移需要修改大量代码  

Kafka
　　单机吞吐量：十万级，最大的优点，就是吞吐量高。
　　topic数量对吞吐量的影响：topic从几十个到几百个的时候，吞吐量会大幅度下降。所以在同等机器下，kafka尽量保证topic数量不要过多。如果要支撑大规模topic，需要增加更多的机器资源
　　时效性：ms级
　　可用性：非常高，kafka是分布式的，一个数据多个副本，少数机器宕机，不会丢失数据，不会导致不可用
　　消息可靠性：经过参数优化配置，消息可以做到0丢失
　　功能支持：功能较为简单，主要支持简单的MQ功能，在大数据领域的实时计算以及日志采集被大规模使用
　　总结：
　　　　kafka的特点其实很明显，就是仅仅提供较少的核心功能，但是提供超高的吞吐量，ms级的延迟，极高的可用性以及可靠性，而且分布式可以任意扩展  
　　　　同时kafka最好是支撑较少的topic数量即可，保证其超高吞吐量  
　　　　kafka唯一的一点劣势是有可能消息重复消费，那么对数据准确性会造成极其轻微的影响，在大数据领域中以及日志采集中，这点轻微影响可以忽略
```



## 其他MQ产品

| 产品     | 说明                                                           |
| ------------------------------------------------------------ | ------------------------------------------------------------ |
| ActiveMQ | 最老牌的开源消息队列，目前已进入老年期，社区不活跃 |
| ZeroMQ   | “一个基于消息队列的多线程网络库”<br/>如果需求是将消息队列的功能集成到系统进程中，可以考虑使用 |
| Pulsar   | 最早是由 Yahoo 开发，目前处于成长期，流行度和成熟度相对没有那么高；<br/>采用存储和计算分离的设计 |



## 如何选择？

一般的业务系统要引入MQ，最早大家都用ActiveMQ，但是现在确实大家用的不多了，没经过大规模吞吐量场景的验证，社区也不是很活跃

后来大家开始用RabbitMQ，但是确实erlang语言阻止了大量的java工程师去深入研究和掌控他，对公司而言，几乎处于不可控的状态，但是确实人家是开源的，比较稳定的支持，活跃度也高；

不过现在确实越来越多的公司，会去用RocketMQ，确实很不错，但是要想好社区万一突然黄掉的风险

 所以中小型公司，技术实力较为一般，技术挑战不是特别高，用RabbitMQ是不错的选择；大型公司，基础架构研发实力较强，用RocketMQ是很好的选择

 如果是大数据领域的实时计算、日志采集等场景，用Kafka是业内标准的，绝对没问题，社区活跃度很高，绝对不会黄，何况几乎是全世界这个领域的事实性规范

## 参考资料

- 中华石杉Java工程师面试突击