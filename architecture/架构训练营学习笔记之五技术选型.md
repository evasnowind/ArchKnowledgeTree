## CAP原理

- Consistency 一致性
  - 强调读取到的数据都是最新的，没有过期数据
- Availability 可用性
  - 每次请求都得到响应，不会报错或是不响应
- Partition Tolerance 分区容错性
  - 部分节点失效时，系统依然可用

![](images/cap-impossible-triangle.png)

重点：

- CAP不可能同时保证，只能3选2
- 对分布式系统而言，P必须保证，因而只能再满足C或是A，即最常见的是CP，AP

### 一致性

常见的一致性保证：

#### 强一致性（Strict Consistency）

- 任何一次读都能读到某个数据的最近一次写的数据。
- 系统中的所有进程，看到的操作顺序，都和全局时钟下的顺序一致。

简言之，在任意时刻，所有节点中的数据是一样的。

#### 顺序一致性（Sequential Consistency）

两个要求：

- 任何一次读都能读到某个数据的最近一次写的数据。
- 系统的所有进程的顺序一致，而且是合理的。即不需要和全局时钟下的顺序一致，错的话一起错，对的话一起对。

范例：zookeeper

#### 弱一致性

数据更新后，如果能容忍后续的访问只能访问到部分或者全部访问不到，则是弱一致性。

最终一致性就属于弱一致性。

#### 最终一致性

不保证在任意时刻任意节点上的同一份数据都是相同的，但是随着时间的迁移，不同节点上的同一份数据总是在向趋同的方向变化。

简单说，就是在一段时间后，节点间的数据会最终达到一致状态。

——以上参考自：https://blog.csdn.net/chao2016/article/details/81149674



### 常见的一致性算法

![](images/consensus-algorithm-summary.jpg)

引自：极客时间《分布式协议与算法实战》 https://time.geekbang.org/column/article/256765

一致性算法回头得系统整理下。

### 一致性解决方案

#### 最终一致性的常见思路
- 根据时间戳，最后写入覆盖。
- 客户端冲突解决
- 投票解决

#### 示例：Cassandra

采用投票解决的思路。

